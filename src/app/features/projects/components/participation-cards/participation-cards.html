<ul class="grid gap-6 sm:grid-cols-2">
  @for (p of participationsStore.participations(); track p.id) {
  <li>
    <article
      class="h-full flex flex-col rounded-lg border border-gray-200 bg-white overflow-hidden transition-shadow duration-200 hover:shadow-md">
      <div class="h-1.5 bg-gradient-to-r from-primary-500 via-primary-600 to-primary-500" aria-hidden="true"></div>
      <div class="flex flex-col flex-1 p-6">
        <header class="flex items-start gap-4 mb-5">
          <img
            [src]="p.user | apiIMG: 'user'"
            [alt]="p.user?.name ?? ''"
            width="48"
            height="48"
            class="size-12 shrink-0 rounded-lg object-cover border border-gray-100 bg-gray-50" />
          <div class="min-w-0 flex-1">
            <h4 class="font-semibold text-gray-900 truncate">{{ p.user?.name ?? '—' }}</h4>
            <p class="text-sm text-gray-500 truncate mt-0.5">{{ p.user?.country ?? '—' }}</p>
            @if (p.venture?.sector) {
            <span
              class="inline-block mt-2 px-2.5 py-1 rounded-full text-xs font-medium bg-primary-50 text-primary-700 border border-primary-100">
              {{ p.venture?.sector }}
            </span>
            }
          </div>
        </header>

        <div class="flex-1 space-y-3">
          <div class="flex items-center gap-3">
            <div class="w-9 h-9 shrink-0 rounded-lg bg-primary-50 text-primary-600 flex items-center justify-center">
              <i-lucide [name]="icons.building2" class="size-4 stroke-[1.5]"></i-lucide>
            </div>
            <h3 class="font-bold text-gray-900 leading-tight">{{ p.venture?.name ?? '—' }}</h3>
          </div>
          @if (p.venture?.description) {
          <p class="text-sm text-gray-600 leading-relaxed line-clamp-2">{{ p.venture?.description }}</p>
          }
          <div class="flex flex-wrap gap-4 text-sm text-gray-500">
            @if (p.venture?.location) {
            <span class="inline-flex items-center gap-1.5">
              <i-lucide [name]="icons.mapPin" class="size-3.5 text-gray-400"></i-lucide>
              {{ p.venture?.location }}
            </span>
            } @if (p.phases?.length) {
            <span class="inline-flex items-center gap-1.5">
              <i-lucide [name]="icons.layers" class="size-3.5 text-gray-400"></i-lucide>
              {{ p.phases?.[0]?.name }}
            </span>
            }
          </div>
        </div>

        <div class="mt-5 pt-5 border-t border-gray-100 space-y-4">
          <div class="flex flex-wrap items-center gap-3">
            @if (p.venture?.slug) {
            <a
              [routerLink]="['/dashboard', 'ventures', p.venture?.slug]"
              class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium text-gray-700 bg-white border border-gray-200 hover:bg-gray-50 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-offset-2">
              <i-lucide [name]="icons.building2" class="size-4"></i-lucide>
              Voir l’entreprise
            </a>
            } @if (voteClos()) {
            <span
              class="inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-gray-400 bg-gray-100 cursor-not-allowed">
              Vote clos
            </span>
            } @else if (p.hasUserVoted) {
            <button
              type="button"
              [disabled]="voteStore.isLoading()"
              class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium text-primary-700 bg-primary-50 border border-primary-200 hover:bg-primary-100 transition-colors disabled:opacity-60 focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-offset-2"
              [attr.aria-label]="voteStore.isLoading() ? 'Vote en cours' : 'Retirer le vote'"
              (click)="removeVote(p.id)">
              <i-lucide [name]="icons.check" class="size-4" stroke-width="2.5"></i-lucide>
              Voté ✓
            </button>
            } @else {
            <button
              type="button"
              (click)="onVoteClick(p.id)"
              [disabled]="voteStore.isLoading()"
              class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 transition-colors disabled:opacity-60 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
              [attr.aria-label]="voteStore.isLoading() ? 'Vote en cours' : 'Voter pour cette candidature'">
              @if (voteStore.isLoading()) {
              <span
                class="size-4 rounded-full border-2 border-white/30 border-t-white animate-spin"
                aria-hidden="true"></span>
              Vote… } @else {
              <i-lucide [name]="icons.thumbsUp" class="size-4"></i-lucide>
              Voter }
            </button>
            }
          </div>
          <div class="flex items-center gap-2 rounded-lg bg-primary-50/80 border border-primary-100 px-3 py-2">
            <i-lucide [name]="icons.thumbsUp" class="size-4 text-primary-600 shrink-0"></i-lucide>
            <span class="text-sm font-medium text-gray-700">
              {{ p.voteCount }} vote{{ p.voteCount !== 1 ? 's' : '' }}
            </span>
          </div>
        </div>
      </div>
    </article>
  </li>
  }
</ul>
