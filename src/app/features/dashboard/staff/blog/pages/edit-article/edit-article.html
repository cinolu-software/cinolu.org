<section class="pt-32 dashboard-main-content flex flex-col gap-4">
  @let article = articleStore.article();
  <div class="mb-4">
    <button
      class="text-primary-400 hover:underline flex items-center gap-2"
      (click)="onGoBack()"
    >
      <i-lucide [name]="icons.back" class="size-4" />
      Revenir en arrière
    </button>
    <h5 class="text-2xl font-bold">Modifier l'article</h5>
  </div>
  <form
    class="w-full md:w-2/3"
    [formGroup]="form"
    (ngSubmit)="onUpdateArticle()"
  >
    <p-stepper [value]="1" class="w-full">
      <p-step-list class="w-full overflow-x-scroll scrollbar-hide">
        <p-step [value]="1" />
        <p-step [value]="2" />
      </p-step-list>
      <p-step-panels>
        <p-step-panel [value]="1">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="w-full">
              <p class="font-medium mb-2">Photo de couverture</p>
              <div
                class="relative h-52 md:h-80 mb-6 w-full pb-8 px-8 lg:px-16 xl:px-24 2xl:px-32 max-w-screen-2xl mx-auto bg-gray-200 rounded"
              >
                @if (article?.image) {
                  <img
                    [ngSrc]="article | apiIMG: 'article'"
                    [alt]="article?.title + ' cover image'"
                    class="aspect-video object-cover h-full opacity-90 rounded border-2 border-slate-200/10"
                    fill
                    priority
                  />
                }
              </div>
              @if (articleStore.isLoading()) {
                <div
                  class="h-20 bg-gray-200 animate-pulse rounded-md w-full mb-4"
                ></div>
              } @else {
                <app-file-upload
                  [name]="'cover'"
                  [url]="url + article?.id"
                  (loaded)="onFileUploadLoaded()"
                />
              }
            </div>
            <div class="flex flex-col gap-4">
              <div class="flex flex-col gap-1.5">
                <label for="title" class="font-medium"
                  >Titre de l'article<span class="text-red-500">*</span></label
                >
                <input pInputText id="title" formControlName="title" />
              </div>
              <div class="flex flex-col gap-1.5">
                <p class="font-medium">Tags de l'article</p>
                <p-multiSelect
                  [inputId]="'id'"
                  [autocomplete]="'off'"
                  [showHeader]="false"
                  [options]="tagsStore.tags()"
                  [optionValue]="'id'"
                  [optionLabel]="'name'"
                  [showClear]="true"
                  formControlName="tags"
                />
              </div>

              <div class="flex justify-end">
                <p-button
                  size="small"
                  variant="outlined"
                  (onClick)="activateCallback(2)"
                >
                  Suivant
                  <i-lucide [name]="icons.next" class="size-4" />
                </p-button>
              </div>
            </div>
          </ng-template>
        </p-step-panel>
        <p-step-panel [value]="2">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="flex flex-col gap-4">
              <div class="flex flex-col gap-1.5">
                <label for="summary" class="font-medium">
                  Résumé<span class="text-red-500">*</span>
                </label>
                <textarea
                  id="summary"
                  pTextarea
                  formControlName="summary"
                  rows="8"
                  cols="30"
                ></textarea>
              </div>

              <div class="flex flex-col gap-1.5">
                <p class="font-medium">
                  Contenu<span class="text-red-500">*</span>
                </p>
                <textarea
                  pTextarea
                  formControlName="content"
                  rows="8"
                  cols="30"
                ></textarea>
              </div>

              <div class="flex py-6 justify-between">
                <p-button
                  size="small"
                  variant="outlined"
                  severity="secondary"
                  (onClick)="activateCallback(1)"
                >
                  <i-lucide [name]="icons.previous" class="size-4" />
                  Précedent
                </p-button>
                <p-button
                  [loading]="store.isLoading()"
                  [disabled]="store.isLoading() || form.invalid"
                  size="small"
                  type="submit"
                >
                  Mettre à jour
                  @if (!store.isLoading()) {
                    <i-lucide [name]="icons.check" class="size-4" />
                  }
                </p-button>
              </div>
            </div>
          </ng-template>
        </p-step-panel>
      </p-step-panels>
    </p-stepper>
  </form>
</section>
