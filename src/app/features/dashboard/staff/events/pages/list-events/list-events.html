<section class="min-h-[105vh] text-gray-600 mt-16">
  @let isLoading = store.isLoading();
  @let hasQuery = queryParams().q;
  @let eventCount = store.events()[1];
  @let eventList = store.events()[0];
  <div class="relative bg-white rounded-lg">
    <div class="flex flex-col gap-3 mb-10 pt-6">
      <div class="px-6 flex flex-wrap gap-2 md:justify-between md:items-center mb-6 md:mb-0">
        <h5 class="text-lg font-bold">
          Liste des événements
          <span class="text-gray-500 ">
            @if (isLoading) {
              <p-progress-spinner
                strokeWidth="5"
                animationDuration=".5s"
                fill="transparent"
                [style]="{ width: '0.8rem', height: '0.8rem' }"
              />
            } @else {
              ({{ eventCount }})
            }
          </span>
        </h5>
        <a pButton [outlined]="true" [size]="'small'" [routerLink]="['/dashboard/events/list/add']"
           class="flex items-center gap-2">
          <i-lucide [name]="icons.plus" class="size-4"/>
          Ajouter un événement
        </a>
      </div>
      <form [formGroup]="searchForm" (ngSubmit)="onSearch()"
            class="px-6 flex flex-col gap-1 md:flex-row md:gap-4">
        <input
          pInputText
          class="py-1! md:w-1/3"
          id="search"
          formControlName="q"
          placeholder="Rechercher..."/>
        <div class="flex items-center gap-1">
          <p-button type="submit" [size]="'small'" [loading]="isLoading"
                    [disabled]="searchForm.invalid || isLoading || (eventCount === 0 && !hasQuery)">
            Rechercher
            @if (!isLoading) {
              <i-lucide [name]="icons.search" class="size-4"/>
            }
          </p-button>
          <p-button [size]="'small'" [outlined]="true" [loading]="isLoading" [disabled]="isLoading || !hasQuery"
                    (click)="onResetSearch()">
            Réinitialiser
            @if (!isLoading) {
              <i-lucide [name]="icons.refresh" class="size-4"/>
            }
          </p-button>
        </div>
      </form>
    </div>
    @if (eventCount === 0 && !isLoading) {
      <h4 class="font-medium text-gray-700 text-lg px-6 pb-8">
        {{
          hasQuery
            ? "Aucun événement trouvé avec ce filtre"
            : "Aucun événement trouvé"
        }}
      </h4>
    }
    @if (isLoading) {
      <div class="grid grid-cols-5 overflow-x-auto">
        @for (i of skeletonArray; track $index) {
          <div class="border-y border-gray-200 py-3 px-6">
            <div class="h-4 rounded-md bg-gray-200 animate-pulse mb-2"></div>
          </div>
        }
      </div>
    }
    @if (eventCount > 0 && !isLoading) {
      <div class="relative flex flex-col overflow-x-auto">
        <table class=" text-left rtl:text-right text-gray-500">
          <thead class="font-black text-gray-800 border-y border-gray-200">
          <tr>
            <th class="px-6 py-3">Image</th>
            <th class="px-6 py-3">Nom</th>
            <th class="px-6 py-3">Début</th>
            <th class="px-6 py-3">Fin</th>
            <th class="px-6 py-3">Status</th>
            <th class="px-6 py-3">Actions</th>
          </tr>
          </thead>
          <tbody>
            @for (event of eventList
              | paginate
              : {
                itemsPerPage: 40,
                currentPage: queryParams().page || 1,
                totalItems: eventCount,
              };
              track event.id) {
              <tr class="odd:bg-white even:bg-gray-50 border-b border-gray-50 whitespace-nowrap">
                <td class="px-6 py-2">
                  <p-avatar [image]="event | apiIMG: 'event'"/>
                </td>
                <td class="px-6 py-2 font-medium text-gray-900">
                  {{ event.name | titlecase }}
                </td>
                <td class="px-6 py-2">
                  {{ event.started_at | date: "shortDate" }}
                </td>
                <td class="px-6 py-2">
                  {{ event.ended_at | date: "shortDate" }}
                </td>
                <td class="px-6 py-2 text-xs capitalize font-medium">
                  @if (event.is_published) {
                    <span
                      class="text-primary-500 bg-primary-400/20 rounded py-1 px-1.5"
                    >publié</span
                    >
                  } @else {
                    <span class="text-red-500 bg-red-400/20 rounded py-1 px-2"
                    >dépublié</span
                    >
                  }
                </td>
                <td class="px-6 py-2">
                  <div class="flex items-center gap-2">
                    <button
                      class="text-primary-500"
                      (click)="onPublishProject(event.id)"
                    >
                      <p-confirmpopup/>
                      @if (!event.is_published) {
                        <i-lucide [name]="icons.eyeOff" class="size-5"/>
                      } @else {
                        <i-lucide [name]="icons.eye" class="size-5"/>
                      }
                    </button>
                    <a
                      [routerLink]="['/dashboard/events/list/edit', event.slug]"
                    >
                      <i-lucide [name]="icons.edit" class="size-4"/>
                    </a>
                    <button
                      class="text-red-500"
                      (click)="onDeleteProject(event.id, $event)"
                    >
                      <p-confirmpopup/>
                      <i-lucide [name]="icons.trash" class="size-4"/>
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
    @if (eventCount > 40) {
      <div class="flex justify-center items-center gap-3 py-8">
        <pagination-controls
          nextLabel=""
          previousLabel=""
          [autoHide]="true"
          [maxSize]="5"
          (pageChange)="onPageChange($event)"
          class="pg"
        >
        </pagination-controls>
      </div>
    }
  </div>
</section>
