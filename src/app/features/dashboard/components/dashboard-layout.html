<div class="min-h-screen flex bg-gray-50">
  <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
    <div
      class="absolute top-[-10%] right-[-10%] w-[500px] h-[500px] bg-primary-500/10 rounded-full blur-[120px] animate-float"></div>
    <div
      class="absolute bottom-[10%] left-[-5%] w-[400px] h-[400px] bg-primary-600/5 rounded-full blur-[100px] animate-float animation-delay-2s"></div>
  </div>

  <aside
    class="w-72 bg-white m-4 rounded-lg flex-col py-6 border border-gray-200 hidden xl:flex shadow-sm sticky top-4 h-[calc(100vh-2rem)]">
    <div class="px-6 mb-8 flex items-center gap-3">
      <div class="w-10 h-10 bg-primary-500 rounded-lg flex items-center justify-center shadow-md">
        <span class="material-icons text-white text-xl">verified</span>
      </div>
      <span class="text-xl font-black tracking-tight text-gray-900">CINOLU</span>
    </div>

    <nav class="flex-1 space-y-1 px-3 overflow-y-auto">
      <div class="text-[10px] uppercase tracking-wider text-gray-500 font-bold px-3 mb-3">Menu Principal</div>
      @for (item of menuItems; track item.path) {
      <a
        [routerLink]="item.path"
        class="w-full flex items-center gap-3 px-3 py-3 text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-all rounded-lg group"
        [class.sidebar-item-active]="isActive(item.path)">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center transition-colors"
          [class.bg-primary-100]="isActive(item.path)"
          [class.bg-gray-100]="!isActive(item.path)"
          [class.border]="true"
          [class.border-primary-200]="isActive(item.path)"
          [class.border-gray-200]="!isActive(item.path)">
          <span
            class="material-icons text-sm transition-colors"
            [class.text-primary-600]="isActive(item.path)"
            [class.text-gray-600]="!isActive(item.path)"
            [class.group-hover:text-gray-900]="!isActive(item.path)"
            >{{ item.icon }}</span
          >
        </div>
        <span class="font-medium text-sm">{{ item.label }}</span>
      </a>
      }
    </nav>

    <div class="px-3 mt-auto space-y-3 pt-4 border-t border-gray-200">
      <div class="px-3 py-4 rounded-lg bg-primary-50 border border-primary-100">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-6 h-6 rounded bg-primary-500 flex items-center justify-center">
            <span class="material-icons text-white text-xs">support_agent</span>
          </div>
          <p class="text-xs font-bold text-primary-900">Support Hub</p>
        </div>
        <p class="text-[10px] text-primary-700 mb-3">Besoin d'aide ? Contactez-nous</p>
        <button
          class="w-full py-2 bg-primary-600 text-white rounded-lg text-xs font-bold hover:bg-primary-700 transition-colors shadow-sm">
          Contacter
        </button>
      </div>
      <button
        (click)="signOut()"
        class="w-full flex items-center justify-center gap-2 px-3 py-3 bg-red-50 text-red-600 rounded-lg text-xs font-bold uppercase tracking-wider hover:bg-red-500 hover:text-white transition-all border border-red-200">
        <span class="material-icons text-base">logout</span>
        Déconnexion
      </button>
    </div>
  </aside>

  <main class="flex-1 flex flex-col min-h-screen">
    <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-md border-b border-gray-200 shadow-sm">
      <div class="px-4 xl:px-8 py-4">
        <div class="flex justify-between items-center">
          <div class="flex items-center gap-4">
            <button (click)="toggleSidebar()" class="xl:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors">
              <span class="material-icons text-gray-700">menu</span>
            </button>
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-primary-100 flex items-center justify-center border border-primary-200">
                <span class="material-icons text-primary-600 text-sm">dashboard</span>
              </div>
              <h1 class="text-xl font-bold text-gray-900">{{ getCurrentPageTitle() }}</h1>
            </div>
          </div>

          <div class="flex items-center gap-3">
            <div class="hidden md:flex items-center gap-2 bg-primary-50 rounded-lg px-3 py-2 border border-primary-200">
              <div class="w-6 h-6 rounded bg-primary-500 flex items-center justify-center">
                <span class="material-icons text-white text-xs">key</span>
              </div>
              <span class="text-xs font-mono text-primary-900 font-bold"
                >{{ authStore.user()?.referral_code || 'N/A' }}</span
              >
            </div>
            <div class="flex items-center gap-3 pl-3 border-l border-gray-200">
              <div class="text-right hidden sm:block">
                <p class="text-sm font-bold text-gray-900 leading-tight">{{ authStore.user()?.name }}</p>
                <p class="text-[10px] text-gray-500 uppercase tracking-wider font-medium">Entrepreneur</p>
              </div>
              <div class="relative">
                @if (authStore.user()?.profile || authStore.user()?.google_image) {
                <div class="relative h-10 w-10">
                  <img
                    [ngSrc]="authStore.user() | apiIMG: 'user'"
                    [alt]="authStore.user()?.name"
                    fill
                    class="rounded-lg object-cover border-2 border-gray-200" />
                </div>
                } @else {
                <div
                  class="w-10 h-10 rounded-lg bg-primary-500 flex items-center justify-center font-bold text-white text-sm shadow-sm border-2 border-primary-400">
                  {{ authStore.user()?.name?.charAt(0) || 'U' }}
                </div>
                }
                <div
                  class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="flex-1 p-4 xl:p-8">
      <router-outlet></router-outlet>
    </div>
  </main>

  @if (isSidebarOpen()) {
  <div
    class="xl:hidden fixed inset-0 bg-black/30 z-40 animate-in fade-in duration-200 backdrop-blur-sm"
    (click)="closeSidebar()"
    (keydown.escape)="closeSidebar()"
    role="button"
    tabindex="0"
    aria-label="Fermer le menu"></div>

  <aside
    class="xl:hidden fixed top-0 left-0 h-screen w-80 bg-white rounded-r-lg flex flex-col py-6 z-50 animate-in slide-in-from-left duration-300 shadow-2xl border-r border-gray-200">
    <div class="px-6 mb-8 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-primary-500 rounded-lg flex items-center justify-center shadow-md">
          <span class="material-icons text-white text-xl">verified</span>
        </div>
        <span class="text-xl font-black tracking-tight text-gray-900">CINOLU</span>
      </div>
      <button (click)="closeSidebar()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
        <span class="material-icons text-gray-700">close</span>
      </button>
    </div>

    <nav class="flex-1 space-y-1 px-3 overflow-y-auto">
      <div class="text-[10px] uppercase tracking-wider text-gray-500 font-bold px-3 mb-3">Menu Principal</div>
      @for (item of menuItems; track item.path) {
      <a
        [routerLink]="item.path"
        (click)="closeSidebar()"
        class="w-full flex items-center gap-3 px-3 py-3 text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-all rounded-lg group"
        [class.sidebar-item-active]="isActive(item.path)">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center transition-colors"
          [class.bg-primary-100]="isActive(item.path)"
          [class.bg-gray-100]="!isActive(item.path)"
          [class.border]="true"
          [class.border-primary-200]="isActive(item.path)"
          [class.border-gray-200]="!isActive(item.path)">
          <span
            class="material-icons text-sm transition-colors"
            [class.text-primary-600]="isActive(item.path)"
            [class.text-gray-600]="!isActive(item.path)"
            >{{ item.icon }}</span
          >
        </div>
        <span class="font-medium text-sm">{{ item.label }}</span>
      </a>
      }
    </nav>

    <div class="px-3 mt-auto space-y-3 pt-4 border-t border-gray-200">
      <div class="px-3 py-4 rounded-lg bg-primary-50 border border-primary-100">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-6 h-6 rounded bg-primary-500 flex items-center justify-center">
            <span class="material-icons text-white text-xs">support_agent</span>
          </div>
          <p class="text-xs font-bold text-primary-900">Support Hub</p>
        </div>
        <p class="text-[10px] text-primary-700 mb-3">Besoin d'aide ? Contactez-nous</p>
        <button
          class="w-full py-2 bg-primary-600 text-white rounded-lg text-xs font-bold hover:bg-primary-700 transition-colors shadow-sm">
          Contacter
        </button>
      </div>
      <button
        (click)="signOut()"
        class="w-full flex items-center justify-center gap-2 px-3 py-3 bg-red-50 text-red-600 rounded-lg text-xs font-bold uppercase tracking-wider hover:bg-red-500 hover:text-white transition-all border border-red-200">
        <span class="material-icons text-base">logout</span>
        Déconnexion
      </button>
    </div>
  </aside>
  }
</div>
<app-back-button />
