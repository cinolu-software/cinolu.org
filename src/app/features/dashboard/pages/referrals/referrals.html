<div class="max-w-7xl dashboard-container">
  <div class="mb-8">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-1">Programme de Parrainage</h1>
    <p class="text-gray-600">Invitez vos amis et développez votre réseau</p>
  </div>

  <!-- Referral Code Section -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <div class="lg:col-span-2 bg-primary-600 rounded-lg p-6 md:p-8 shadow-md text-white">
      <div class="flex items-center gap-3 mb-6">
        <span class="material-icons text-[32px]">card_giftcard</span>
        <h2 class="text-xl font-bold">Votre code de parrainage</h2>
      </div>

      @if (referralsStore.referralCode()) {
      <div class="mb-6">
        <div class="flex flex-col sm:flex-row gap-3 items-stretch">
          <div
            class="flex-1 bg-white/20 backdrop-blur-sm rounded-lg px-6 py-4 text-center font-mono text-2xl font-bold tracking-wider border-2 border-white/30">
            {{ referralsStore.referralCode() }}
          </div>
          <button
            (click)="copyReferralCode()"
            class="px-6 py-4 bg-white text-primary-600 font-semibold rounded-lg hover:bg-primary-50 transition-all flex items-center justify-center gap-2">
            <span class="material-icons text-[20px]">{{ copied() ? 'check' : 'content_copy' }}</span>
            {{ copied() ? 'Copié !' : 'Copier' }}
          </button>
        </div>
      </div>

      <div>
        <label for="referral-link" class="block text-sm font-semibold text-white/90 mb-2">Lien de parrainage</label>
        <div class="flex gap-3">
          <input
            id="referral-link"
            type="text"
            [value]="getReferralLink()"
            readonly
            class="flex-1 px-4 py-3 rounded-lg bg-white/20 backdrop-blur-sm border-2 border-white/30 text-white placeholder-white/60 font-medium" />
          <button
            (click)="copyReferralLink()"
            class="px-4 py-3 bg-white/20 hover:bg-white/30 backdrop-blur-sm border-2 border-white/30 rounded-lg transition-all">
            <span class="material-icons text-white">link</span>
          </button>
        </div>
      </div>
      } @else {
      <div class="text-center py-8">
        <p class="text-white/90 mb-4">Vous n'avez pas encore de code de parrainage</p>
        <button
          (click)="generateCode()"
          class="inline-flex items-center gap-2 px-6 py-3 bg-white text-primary-600 font-semibold rounded-lg hover:bg-primary-50 transition-all disabled:opacity-50"
          [disabled]="referralsStore.isLoading()">
          @if (referralsStore.isLoading()) {
          <div class="w-5 h-5 border-2 border-primary-600 border-t-transparent rounded-full animate-spin"></div>
          Génération... } @else {
          <span class="material-icons">add</span>
          Générer mon code }
        </button>
      </div>
      }
    </div>

    <!-- Benefits Card -->
    <div class="bg-white rounded-lg shadow-md p-6 border border-gray-100">
      <h3 class="text-lg font-bold text-gray-900 mb-4">Avantages du parrainage</h3>
      <ul class="space-y-3">
        <li class="flex items-start gap-3">
          <span class="material-icons text-primary-500 text-[20px] mt-0.5">check_circle</span>
          <span class="text-sm text-gray-700">Développez votre réseau professionnel</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="material-icons text-primary-500 text-[20px] mt-0.5">check_circle</span>
          <span class="text-sm text-gray-700">Aidez d'autres entrepreneurs à démarrer</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="material-icons text-primary-500 text-[20px] mt-0.5">check_circle</span>
          <span class="text-sm text-gray-700">Participez à la croissance de la communauté</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- Referrals List -->
  <div>
    <div class="mb-5">
      <h2 class="text-xl font-bold text-gray-900">
        Utilisateurs inscrits via mon lien ({{ referralsStore.referredUsers().length }})
      </h2>
    </div>

    @if (referralsStore.isLoadingReferredUsers()) {
    <div class="flex flex-col items-center justify-center py-16">
      <div class="w-12 h-12 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mb-4"></div>
      <p class="text-gray-600">Chargement...</p>
    </div>
    } @else if (!referralsStore.hasReferredUsers()) {
    <div class="flex flex-col items-center justify-center py-16 px-4">
      <span class="material-icons text-gray-300 text-[64px] mb-4">group</span>
      <h3 class="text-xl font-bold text-gray-900 mb-2">Aucun utilisateur inscrit pour le moment</h3>
      <p class="text-gray-600 text-center">Partagez votre code de parrainage pour inviter de nouveaux membres</p>
    </div>
    } @else {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
      @for (referral of (referralsStore.referredUsers() || []); track referral.id) {
      <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-all p-5 border border-gray-100">
        <div class="flex items-center gap-4">
          <div
            class="w-14 h-14 rounded-full overflow-hidden bg-gradient-to-br from-primary-500 to-purple-600 flex items-center justify-center flex-shrink-0">
            @if (referral.profile || referral.google_image) {
            <img
              [src]="referral.profile || referral.google_image"
              [alt]="referral.name"
              class="w-full h-full object-cover" />
            } @else {
            <span class="text-white text-xl font-bold">{{ referral.name.charAt(0) }}</span>
            }
          </div>
          <div class="flex-1 min-w-0">
            <h4 class="text-base font-bold text-gray-900 truncate">{{ referral.name }}</h4>
            <p class="text-sm text-gray-600 truncate">{{ referral.email }}</p>
            @if (referral.created_at) {
            <p class="flex items-center gap-1 text-xs text-gray-500 mt-1">
              <span class="material-icons text-[14px]">schedule</span>
              Rejoint le {{ referral.created_at | date:'dd/MM/yyyy' }}
            </p>
            }
          </div>
        </div>
      </div>
      }
    </div>
    }
  </div>
</div>
