<div class="dashboard-container">
  <!-- Page Header  -->
  <div class="dashboard-section">
    <div class="flex items-center gap-4 mb-3">
      <div
        class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center shadow-lg">
        <span class="material-icons text-white text-2xl">person</span>
      </div>
      <div>
        <h1 class="dashboard-heading-2">Mon <span class="dashboard-text-gradient-purple">Profil</span></h1>
        <p class="dashboard-text-small">Gérez vos informations personnelles et votre photo de profil</p>
      </div>
    </div>
  </div>

  <div class="dashboard-grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Photo de profil  - Sidebar -->
    <div class="lg:col-span-1">
      <div class="dashboard-card-elevated p-8 sticky top-[120px]">
        <h2 class="dashboard-heading-5 mb-6">Photo de profil</h2>

        <div class="flex flex-col items-center">
          <!-- Avatar  avec border animé -->
          <div class="relative mb-6 group">
            <div
              class="absolute -inset-1 bg-gradient-to-r from-purple-500 via-pink-500 to-brand-500 rounded-full blur opacity-30 group-hover:opacity-50 transition duration-1000 group-hover:duration-200 animate-pulse"></div>
            @if (authStore.user()?.profile || authStore.user()?.google_image) {
            <div class="relative">
              <img
                [src]="authStore.user() | apiIMG: 'user'"
                [alt]="authStore.user()?.name"
                class="relative w-44 h-44 rounded-full object-cover border-4 border-white shadow-2xl transition-transform group-hover:scale-105 duration-300" />
            </div>
            } @else {
            <div
              class="relative w-44 h-44 rounded-full bg-gradient-to-br from-brand-500 to-brand-700 flex items-center justify-center border-4 border-white shadow-2xl transition-transform group-hover:scale-105 duration-300">
              <span class="material-icons text-white text-[80px]">person</span>
            </div>
            } @if (authStore.isLoading()) {
            <div
              class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm rounded-full flex items-center justify-center">
              <div class="w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
            </div>
            }
          </div>

          <!-- Upload Section  -->
          <div class="w-full space-y-4">
            <app-file-upload [name]="'profile'" [url]="getUploadUrl()" (loaded)="handleLoaded()" />

            <div class="dashboard-card p-3 text-center">
              <p class="dashboard-text-tiny flex items-center justify-center gap-1.5">
                <span class="material-icons text-slate-400 text-[14px]">info</span>
                <span>JPG, PNG ou WEBP • Max 1MB</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Form  -->
    <div class="lg:col-span-2">
      <div class="dashboard-card-elevated p-8">
        <!-- Header with Edit Button -->
        <div class="flex items-center justify-between flex-wrap gap-3 mb-8 pb-6 border-b border-slate-100">
          <div class="flex items-center gap-3">
            <div
              class="w-11 h-11 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg">
              <span class="material-icons text-white text-xl">badge</span>
            </div>
            <div>
              <h2 class="dashboard-heading-5">Informations personnelles</h2>
              <p class="dashboard-text-tiny">Mettez à jour vos coordonnées</p>
            </div>
          </div>
          @if (!isEditing()) {
          <button type="button" (click)="toggleEdit()" class="dashboard-btn-primary inline-flex max-sm:w-full">
            <span class="material-icons text-[18px]">edit</span>
            <span>Modifier</span>
          </button>
          }
        </div>

        <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="space-y-6">
          <!-- Name and Email -->
          <div class="dashboard-grid-2">
            <div class="form-group">
              <label for="name" class="dashboard-label">
                <span class="material-icons text-[16px] text-brand-600">person</span>
                <span>Nom complet <span class="text-red-500">*</span></span>
              </label>
              <input
                id="name"
                type="text"
                formControlName="name"
                [readonly]="!isEditing()"
                [class]="isEditing() ? 'dashboard-input' : 'dashboard-input !bg-slate-50 !border-slate-100 text-slate-600'" />
            </div>

            <div class="form-group">
              <label for="email" class="dashboard-label">
                <span class="material-icons text-[16px] text-indigo-600">email</span>
                <span>Email</span>
              </label>
              <input
                id="email"
                type="email"
                [value]="authStore.user()?.email"
                readonly
                class="dashboard-input !bg-slate-50 !border-slate-100 text-slate-500 cursor-not-allowed" />
            </div>
          </div>

          <!-- Phone and Gender -->
          <div class="dashboard-grid-2">
            <div class="form-group">
              <label for="phone_number" class="dashboard-label">
                <span class="material-icons text-[16px] text-blue-600">phone</span>
                <span>Téléphone</span>
              </label>
              <input
                id="phone_number"
                type="tel"
                formControlName="phone_number"
                [readonly]="!isEditing()"
                [class]="isEditing() ? 'dashboard-input' : 'dashboard-input !bg-slate-50 !border-slate-100 text-slate-600'" />
            </div>

            <div class="form-group">
              <label for="gender" class="dashboard-label">
                <span class="material-icons text-[16px] text-purple-600">wc</span>
                <span>Genre</span>
              </label>
              <select
                id="gender"
                formControlName="gender"
                [class]="isEditing() ? 'dashboard-select' : 'dashboard-select !bg-slate-50 !border-slate-100 text-slate-600 pointer-events-none'">
                <option value="">Sélectionner</option>
                <option value="male">Homme</option>
                <option value="female">Femme</option>
              </select>
            </div>
          </div>

          <div class="dashboard-grid-2">
            <div class="form-group">
              <label for="city" class="dashboard-label">
                <span class="material-icons text-[16px] text-teal-600">location_city</span>
                <span>Ville</span>
              </label>
              <input
                id="city"
                type="text"
                formControlName="city"
                [readonly]="!isEditing()"
                [class]="isEditing() ? 'dashboard-input' : 'dashboard-input !bg-slate-50 !border-slate-100 text-slate-600'" />
            </div>

            <div class="form-group">
              <label for="country" class="dashboard-label">
                <span class="material-icons text-[16px] text-emerald-600">public</span>
                <span>Pays</span>
              </label>
              <input
                id="country"
                type="text"
                formControlName="country"
                [readonly]="!isEditing()"
                [class]="isEditing() ? 'dashboard-input' : 'dashboard-input !bg-slate-50 !border-slate-100 text-slate-600'" />
            </div>
          </div>

          <div>
            <label for="birth_date" class="dashboard-label">
              <span class="material-icons text-[16px] text-pink-600">cake</span>
              <span>Date de naissance</span>
            </label>
            <p-datepicker
              inputId="birth_date"
              formControlName="birth_date"
              dateFormat="dd/mm/yy"
              [showIcon]="isEditing()"
              placeholder="Sélectionner une date"
              [fluid]="true" />
          </div>

          <div>
            <label for="biography" class="dashboard-label">
              <span class="material-icons text-[16px] text-amber-600">description</span>
              <span>Biographie</span>
            </label>
            <textarea
              id="biography"
              formControlName="biography"
              [readonly]="!isEditing()"
              [class]="isEditing() ? 'dashboard-textarea' : 'dashboard-textarea !bg-slate-50 !border-slate-100 text-slate-600'"
              placeholder="Parlez-nous de vous..."></textarea>
          </div>

          <!-- Action Buttons  -->
          @if (isEditing()) {
          <div class="flex flex-col-reverse sm:flex-row gap-3 justify-end pt-8 border-t border-slate-100">
            <button type="button" (click)="cancelEdit()" class="dashboard-btn-secondary">
              <span class="material-icons text-[18px]">close</span>
              <span>Annuler</span>
            </button>
            <button
              type="submit"
              [disabled]="profileForm.invalid || authStore.isLoading()"
              class="dashboard-btn-primary">
              @if (authStore.isLoading()) {
              <div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
              <span>Enregistrement...</span>
              } @else {
              <span class="material-icons text-[18px]">save</span>
              <span>Enregistrer les modifications</span>
              }
            </button>
          </div>
          }
        </form>
      </div>
    </div>
  </div>
</div>
