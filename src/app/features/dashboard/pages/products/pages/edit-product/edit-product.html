<section class="pt-32 dashboard-main-content flex flex-col gap-4">
  @let product = productStore.product();
  <div class="flex flex-col gap-4 mb-10">
    <p class="font-medium">Galerie</p>
    <div class="w-full md:w-1/3">
      @if (productStore.isLoading()) {
      <div class="h-20 bg-gray-200 animate-pulse rounded-lg w-full mb-4"></div>
      } @else {
      <app-file-upload
        [multiple]="true"
        [name]="'image'"
        [url]="galleryUrl + product?.id"
        (loaded)="onFileUploadLoaded()" />
      }
    </div>
    <div class="flex flex-wrap gap-3">
      @for (image of galleryStore.gallery(); track image.id) {
      <div
        class="relative w-36 h-28 bg-gray-200 aspect-square rounded overflow-hidden border-2 border-slate-200/10 group">
        <img
          class="object-cover h-full"
          priority
          fill
          [ngSrc]="image | apiIMG: 'productGallery'"
          [alt]="product?.name + ' gallery image'" />
        <button
          type="button"
          (click)="onDeleteImage(image.id)"
          class="absolute top-2 right-2 p-1.5 z-90 bg-red-500/80 hover:bg-red-600 rounded-full shadow-md opacity-0 group-hover:opacity-100 transition">
          <i-lucide [name]="icons.trash" class="w-4 h-4 text-white" />
        </button>
      </div>
      }
    </div>
  </div>
  <form class="w-full" [formGroup]="form" (ngSubmit)="onEditProduct()">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="flex flex-col gap-2">
        <div class="flex flex-col gap-1 5">
          <label for="ventureId" class="font-medium">Entreprise</label>
          <p-select
            [inputId]="'ventureId'"
            optionLabel="name"
            optionValue="id"
            placeholder="Sélectionner une entreprise"
            [options]="venturesStore.ventures()"
            formControlName="ventureId" />
        </div>
        <div class="flex flex-col gap-1.5">
          <label for="name" class="font-medium">Nom du produit<span class="text-red-500">*</span></label>
          <input pInputText id="name" formControlName="name" />
        </div>
        <div class="flex flex-col gap-1.5">
          <div class="flex flex-col gap-1.5">
            <label for="price" class="font-medium">Prix du produit<span class="text-red-500">*</span></label>
            <input pInputText type="number" id="price" formControlName="price" />
          </div>
        </div>
        <div class="flex py-3 justify-between">
          <p-button
            [loading]="store.isLoading()"
            [disabled]="store.isLoading() || form.invalid"
            size="small"
            type="submit">
            Mettre à jour le produit
          </p-button>
        </div>
      </div>
      <div class="flex flex-col gap-1.5">
        <label for="description" class="font-medium"> Description(255) <span class="text-red-500">*</span> </label>
        <textarea [id]="'description'" pTextarea formControlName="description" rows="5" cols="30"></textarea>
      </div>
    </div>
  </form>
</section>
