<div class="relative">
  <button
    (click)="toggleDropdown($event)"
    class="lang-switcher-button flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-primary-500/10 active:bg-primary-500/20 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500/30"
    [attr.aria-label]="'Changer de langue'">
    <img [src]="currentLangInfo().flag" [alt]="currentLangInfo().name" class="w-6 h-6 rounded" />
    <span class="text-sm font-medium hidden sm:inline"> {{ currentLangInfo().code.toUpperCase() }} </span>
    <i-lucide
      [name]="icons.chevronDown"
      class="w-4 h-4 opacity-70 transition-transform duration-200"
      [class.rotate-180]="isOpen" />
  </button>

  @if (isOpen) {
  <div
    class="lang-switcher-dropdown absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-slate-200 py-1 z-50 anim-fade-in">
    @for (lang of languageService.availableLanguages; track lang.code) {
    <button
      (click)="selectLanguage(lang.code)"
      class="w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 transition-colors duration-150"
      [class.bg-primary-50]="lang.code === languageService.currentLanguage()">
      <img [src]="lang.flag" [alt]="lang.name" class="w-6 h-6 rounded" />
      <span class="text-sm font-medium text-gray-700 flex-1 text-left">{{ lang.name }}</span>
      @if (lang.code === languageService.currentLanguage()) {
      <i-lucide [name]="icons.check" class="w-5 h-5 text-primary-500" />
      }
    </button>
    }

    <div class="px-4 py-2 text-xs text-gray-500 border-t border-gray-200 mt-1">{{ 'common.welcome' | translate }}</div>
  </div>
  }
</div>
